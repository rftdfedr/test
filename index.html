<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EchoNet</title>
  <style>
    /* –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º —Å–≤–µ—á–µ–Ω–∏—è */
textarea::-webkit-scrollbar {
    width: 14px;
}

textarea::-webkit-scrollbar-track {
    background: var(--dark-bg);
    border-left: 1px solid var(--soft-yellow);
    box-shadow: inset 0 0 5px var(--soft-yellow-glow);
}

textarea::-webkit-scrollbar-thumb {
    background: var(--soft-yellow);
    border: 2px solid var(--dark-bg);
    border-radius: 2px;
    box-shadow: 
        0 0 5px var(--soft-yellow-glow),
        inset 0 0 3px var(--dark-bg);
}

textarea::-webkit-scrollbar-thumb:hover {
    background: #ffd85c;
    box-shadow: 
        0 0 10px var(--soft-yellow-glow),
        0 0 15px var(--soft-yellow-glow),
        inset 0 0 3px var(--dark-bg);
}

textarea::-webkit-scrollbar-thumb:active {
    background: #ffbb00;
}

/* –¢–æ–Ω–∫–∏–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ */
#history-list::-webkit-scrollbar {
    width: 8px;
}

#history-list::-webkit-scrollbar-track {
    background: transparent;
}

#history-list::-webkit-scrollbar-thumb {
    background: var(--soft-yellow);
    border-radius: 2px;
    box-shadow: 0 0 3px var(--soft-yellow-glow);
}

#history-list::-webkit-scrollbar-thumb:hover {
    background: #ffd85c;
    box-shadow: 0 0 6px var(--soft-yellow-glow);
}

/* –°—Ç–∏–ª–∏ –¥–ª—è Firefox */
textarea {
    scrollbar-width: thin;
    scrollbar-color: var(--soft-yellow) var(--dark-bg);
}

#history-list {
    scrollbar-width: thin;
    scrollbar-color: var(--soft-yellow) transparent;
}

.tab-content {
    scrollbar-width: thin;
    scrollbar-color: var(--dark-border) transparent;
}
    /* –ú—è–≥–∫–∏–π –∂—ë–ª—Ç—ã–π —Ü–≤–µ—Ç #FFCF40 */
    :root {
      --soft-yellow: #ffcf40;
      --soft-yellow-glow: rgba(255, 207, 64, 0.7);
      --creepy-red: #ff3300;
      --creepy-red-glow: rgba(255, 51, 0, 0.8);
      --dark-bg: #000000;
      --dark-bg-2: #331f00;
      --dark-border: #664d00;
    }

    /* –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
    body {
      margin: 0;
      background: var(--dark-bg);
      color: var(--soft-yellow);
      font-family: 'Courier New', Courier, monospace;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    #left-panel {
      width: 100%;
      background: var(--dark-bg);
      display: flex;
      flex-direction: column;
      border-bottom: 2px solid var(--soft-yellow);
      box-sizing: border-box;
      max-height: 50vh;
    }

    /* –í–∫–ª–∞–¥–∫–∏ */
    .tabs {
      display: flex;
      background: var(--dark-bg);
      border-bottom: 2px solid var(--soft-yellow);
    }
    .tab {
      flex: 1;
      padding: 12px 0;
      text-align: center;
      cursor: pointer;
      color: var(--soft-yellow);
      user-select: none;
      border-bottom: 3px solid transparent;
      transition: border-color 0.3s;
      text-shadow:
        0 0 5px var(--soft-yellow-glow),
        0 0 10px var(--soft-yellow-glow),
        0 0 20px var(--soft-yellow-glow);
      position: relative;
      font-size: 14px;
    }
    .tab.active {
      border-bottom-color: #ffd85c;
      font-weight: bold;
      color: #ffd85c;
      text-shadow:
        0 0 10px #ffd85c,
        0 0 20px #ffd85c,
        0 0 30px #ffd85c;
    }
    /* –ó–Ω–∞—á–æ–∫ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ */
    .tab .badge {
      position: absolute;
      top: 6px;
      right: 12px;
      font-weight: bold;
      color: var(--soft-yellow);
      user-select: none;
      pointer-events: none;
      font-size: 18px;
      line-height: 1;
    }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ */
    .tab-content {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background: var(--dark-bg);
      box-shadow:
        inset 0 0 40px var(--soft-yellow-glow);
      display: flex;
      flex-direction: column;
    }

    /* –ö–Ω–æ–ø–∫–∏ */
    button {
      font-family: 'Courier New', Courier, monospace;
      font-size: 16px;
      background: transparent;
      border: 2px solid var(--soft-yellow);
      color: var(--soft-yellow);
      padding: 12px 20px;
      cursor: pointer;
      border-radius: 0;
      text-shadow:
        0 0 5px var(--soft-yellow-glow),
        0 0 10px var(--soft-yellow-glow);
      transition: background-color 0.3s, color 0.3s;
      align-self: flex-start;
    }
    button:hover:not(:disabled) {
      background-color: #ffd85c;
      color: #000000;
      text-shadow: none;
    }
    button:disabled {
      border-color: var(--dark-border);
      color: var(--dark-border);
      cursor: default;
      text-shadow: none;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è */
    .controls-row {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-top: 15px;
    }

    /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–∞ */
    .filter-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 15px;
      border: 2px solid var(--soft-yellow);
      background: transparent;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--dark-border);
      transition: .4s;
      border: 1px solid var(--soft-yellow);
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 3px;
      background-color: var(--soft-yellow);
      transition: .4s;
    }
    input:checked + .slider {
      background-color: var(--soft-yellow);
    }
    input:checked + .slider:before {
      background-color: var(--dark-bg);
      transform: translateX(26px);
    }
    .filter-label {
      font-size: 14px;
      color: var(--soft-yellow);
      text-shadow: 0 0 5px var(--soft-yellow-glow);
      white-space: nowrap;
    }
    .filter-status {
      font-size: 12px;
      color: var(--soft-yellow);
      margin-top: 4px;
    }
    .filter-status.active {
      color: #ffd85c;
      font-weight: bold;
      text-shadow: 0 0 10px #ffd85c;
    }

    /* –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø–æ–≤ */
    table {
      width: 100%;
      border-collapse: collapse;
      color: var(--soft-yellow);
      text-shadow:
        0 0 5px var(--soft-yellow-glow);
      margin-top: 10px;
    }
    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid var(--dark-border);
      text-align: left;
      font-size: 12px;
    }
    th {
      background: var(--dark-bg-2);
    }
    .status-online {
      color: #ffd85c;
      font-weight: bold;
      text-shadow:
        0 0 10px #ffd85c;
    }
    .status-offline {
      color: var(--creepy-red);
      font-weight: bold;
      text-shadow:
        0 0 15px var(--creepy-red-glow),
        0 0 30px var(--creepy-red-glow);
    }
    .connection-good {
      color: var(--soft-yellow);
    }
    .connection-bad {
      color: var(--creepy-red);
      font-weight: bold;
    }
    .reconnect-btn {
      background: transparent;
      border: 1px solid var(--soft-yellow);
      color: var(--soft-yellow);
      padding: 6px 12px;
      font-family: 'Courier New', Courier, monospace;
      font-size: 11px;
      cursor: pointer;
      text-shadow:
        0 0 5px var(--soft-yellow-glow);
      transition: background-color 0.3s, color 0.3s;
      border-radius: 0;
    }
    .reconnect-btn:hover:not(:disabled) {
      background-color: #ffd85c;
      color: #000000;
      text-shadow: none;
    }
    .reconnect-btn:disabled {
      border-color: var(--dark-border);
      color: var(--dark-border);
      cursor: default;
      text-shadow: none;
    }

    /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ */
    #history-list {
      width: 100%;
      height: 200px;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 3px;
      color: var(--soft-yellow);
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      overflow-y: auto;
      padding: 8px;
      box-sizing: border-box;
      margin-bottom: 10px;
      text-shadow:
        0 0 5px var(--soft-yellow-glow);
      outline: none;
      user-select: none;
    }
    #history-list:focus {
      border-color: transparent;
      background-color: transparent;
      color: var(--soft-yellow);
    }
    #history-list .option {
      padding: 6px 8px;
      cursor: pointer;
      border-radius: 3px;
      margin-bottom: 2px;
      transition: background-color 0.3s, color 0.3s;
      user-select: none;
    }
    #history-list .option:hover {
      background-color: var(--soft-yellow);
      color: #000000;
    }
    #history-list .option.selected {
      background-color: var(--soft-yellow);
      color: #000000;
      font-weight: bold;
      text-shadow: none;
    }

    /* –ü—Ä–∞–≤–∞—è –∫–æ–Ω—Å–æ–ª—å */
    #right-panel {
      flex: 1;
      background: var(--dark-bg);
      display: flex;
      flex-direction: column;
      padding: 15px;
      color: var(--soft-yellow);
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      box-shadow:
        inset 0 0 50px var(--soft-yellow-glow);
      position: relative;
      overflow: hidden;
    }
    textarea {
      background: var(--dark-bg);
      border: none;
      color: var(--soft-yellow);
      resize: none;
      overflow-y: auto;
      margin-bottom: 10px;
      font-size: 14px;
      font-family: 'Courier New', Courier, monospace;
      padding: 8px;
      border-radius: 0;
      text-shadow:
        0 0 5px var(--soft-yellow-glow),
        0 0 15px var(--soft-yellow-glow);
      position: relative;
      z-index: 2;
      outline: none;
    }
    textarea:focus {
      outline: none;
      border: none;
    }
    #status-text {
      height: 40px;
      overflow-y: hidden;
    }
    #binary-text {
      height: 120px;
    }
    #result-text {
      height: 200px;
    }
    .creepy {
      color: var(--creepy-red);
      font-weight: bold;
      text-shadow:
        0 0 15px var(--creepy-red-glow),
        0 0 30px var(--creepy-red-glow),
        0 0 45px var(--creepy-red-glow);
    }
#result-text.creepy {
    color: var(--creepy-red);
    text-shadow:
        0 0 10px var(--creepy-red-glow),
        0 0 20px var(--creepy-red-glow),
        0 0 30px var(--creepy-red-glow);
}
    /* –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ */
    #decrypt-btn {
      align-self: center;
      margin: 10px 0;
      width: 100%;
    }

    /* –£—Å–∏–ª–µ–Ω–Ω—ã–π –≥–ª–∏—á —ç—Ñ—Ñ–µ–∫—Ç (–∏—Å–∫–∞–∂–µ–Ω–∏–µ –∫–∞–¥—Ä–∞) */
    #right-panel::before {
      content: "";
      pointer-events: none;
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background:
        repeating-linear-gradient(
          0deg,
          rgba(255, 207, 64, 0.12),
          rgba(255, 207, 64, 0.12) 2px,
          transparent 3px,
          transparent 4px
        ),
        repeating-linear-gradient(
          90deg,
          rgba(255, 207, 64, 0.06),
          rgba(255, 207, 64, 0.06) 1px,
          transparent 2px,
          transparent 3px
        );
      mix-blend-mode: screen;
      animation: glitchShift 0.25s infinite alternate;
      z-index: 1;
      filter: contrast(1.3) brightness(1.15);
    }

    @keyframes glitchShift {
      0% {
        transform: translate(0, 0);
        opacity: 0.95;
      }
      50% {
        transform: translate(3px, -3px);
        opacity: 0.75;
      }
      100% {
        transform: translate(-3px, 3px);
        opacity: 0.95;
      }
    }

    /* –ú–µ—Ä—Ü–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
    @keyframes flicker {
      0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {
        opacity: 1;
      }
      20%, 22%, 24%, 55% {
        opacity: 0.4;
      }
    }
    #right-panel textarea {
      animation: flicker 3s infinite;
    }

    /* –ö—É—Ä—Å–æ—Ä –º–µ—Ä—Ü–∞—é—â–∏–π */
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    .cursor {
      display: inline-block;
      width: 8px;
      background: var(--soft-yellow);
      margin-left: 2px;
      animation: blink 1s step-start infinite;
    }

    /* –°—Ç–∏–ª—å –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading {
      color: var(--soft-yellow);
      text-align: center;
      padding: 20px;
    }

    /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã */
    @media (min-width: 768px) {
      body {
        flex-direction: row;
      }
      
      #left-panel {
        width: 50%;
        max-height: 100vh;
        border-right: 2px solid var(--soft-yellow);
        border-bottom: none;
      }
      
      .controls-row {
        flex-direction: row;
      }
      
      #decrypt-btn {
        width: 200px;
      }
      
      #binary-text {
        height: 140px;
      }
      
      #result-text {
        height: 350px;
      }
      
      #history-list {
        height: 300px;
      }
      
      th, td {
        font-size: 14px;
        padding: 10px 8px;
      }
      
      .tab {
        font-size: 16px;
      }
    }

    @media (min-width: 1024px) {
      #left-panel {
        width: 700px;
      }
    }
  </style>
</head>
<body>
  <div id="left-panel">
    <div class="tabs">
      <div class="tab active" data-tab="signals">–°–∏–≥–Ω–∞–ª—ã</div>
      <div class="tab" data-tab="telescopes">–†–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø—ã</div>
      <div class="tab" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤</div>
    </div>
    <div id="signals" class="tab-content">
      <div style="font-size: 18px; margin-bottom: 10px;">–ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª?</div>
      
      <div class="controls-row">
        <button id="receive-btn" disabled>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤...</button>
        
        <div class="filter-container">
          <div class="filter-label">–§–∏–ª—å—Ç—Ä —á–∞—Å—Ç–æ—Ç</div>
          <label class="switch">
            <input type="checkbox" id="filter-toggle">
            <span class="slider"></span>
          </label>
          <div class="filter-status" id="filter-status">–í–´–ö–õ</div>
        </div>
      </div>
      
      <div id="loading-status" class="loading"></div>
    </div>
    <div id="telescopes" class="tab-content" style="display:none;">
      <table>
        <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="telescopes-body"></tbody>
      </table>
    </div>
    <div id="history" class="tab-content" style="display:none; flex-direction: column;">
      <div id="history-list" tabindex="0"></div>
      <button id="delete-button">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π</button>
    </div>
  </div>
  <div id="right-panel">
    <textarea id="status-text" readonly></textarea>
    <textarea id="binary-text" readonly></textarea>
    <button id="decrypt-btn" disabled>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
    <textarea id="result-text" readonly></textarea>
  </div>

  <script>
    // –§–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    let reconnectInProgress = new Set();

    // –ó–≤—É–∫–∏
    const ambientAudio = new Audio('sound/ambient.mp3');
    ambientAudio.loop = true;
    ambientAudio.volume = 0.30;

    const priemAudio = new Audio('sound/priem-obrabotra.mp3');
    priemAudio.volume = 0.5;

    const radiooffAudio = new Audio('sound/radiooff.mp3');
    radiooffAudio.volume = 0.5;

    // –ó–≤—É–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
    const decryptAudio1 = new Audio('sound/random_dechifrator_1.mp3');
    const decryptAudio2 = new Audio('sound/random_dechifrator_2.mp3');
    const comSound = new Audio('sound/com.mp3');
    decryptAudio1.volume = 0.5;
    decryptAudio2.volume = 0.5;
    comSound.volume = 0.08;

    // –î–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª–æ–≤ (–±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ñ–∞–π–ª–æ–≤)
    let NORMAL_SIGNALS = [];
    let CREEPY_SIGNALS = [];

    // –†–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø—ã
    const TELESCOPES = [
      {name: "–†–ê–¢–ê–ù-600 (–°–ê–û –†–ê–ù)", status: "online", connection: "–•–æ—Ä–æ—à–µ–µ"},
      {name: "–†–¢-70 (–ü—É—â–∏–Ω–æ)", status: "online", connection: "–•–æ—Ä–æ—à–µ–µ"},
      {name: "–†–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø –ó–≤–µ–∑–¥–∞ (–ö–∞–ª—è–∑–∏–Ω)", status: "online", connection: "–•–æ—Ä–æ—à–µ–µ"},
      {name: "–†–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø –ö–≤–∞–∑–∞—Ä-–ö–í–û (–ö—Ä—ã–º)", status: "online", connection: "–•–æ—Ä–æ—à–µ–µ"}
    ];

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    const receiveBtn = document.getElementById('receive-btn');
    const statusText = document.getElementById('status-text');
    const binaryText = document.getElementById('binary-text');
    const resultText = document.getElementById('result-text');
    const telescopesBody = document.getElementById('telescopes-body');
    const historyList = document.getElementById('history-list');
    const deleteButton = document.getElementById('delete-button');
    const loadingStatus = document.getElementById('loading-status');
    const decryptBtn = document.getElementById('decrypt-btn');
    const filterToggle = document.getElementById('filter-toggle');
    const filterStatus = document.getElementById('filter-status');

    // –ò—Å—Ç–æ—Ä–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤
    let signalHistory = [];
    let creepyActive = false;
    let currentBinarySignal = '';
    let currentResultSignal = '';
    let currentDecryptAudio = null;

    // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
    let usedNormalSignals = new Set();
    let usedCreepySignals = new Set();

    // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
    let isDecrypting = false;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è —Å–∏–≥–Ω–∞–ª–∞
    function getRandomSignal(signalArray, usedSet) {
        // –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –≤—ã–∫–ª—é—á–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ª—é–±–æ–π —Å–ª—É—á–∞–π–Ω—ã–π —Å–∏–≥–Ω–∞–ª
        if (!filterToggle.checked) {
            return signalArray[Math.floor(Math.random() * signalArray.length)];
        }
        
        // –ï—Å–ª–∏ –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫
        if (usedSet.size >= signalArray.length) {
            usedSet.clear();
        }
        
        let availableSignals = signalArray.filter((_, index) => !usedSet.has(index));
        
        if (availableSignals.length === 0) {
            // –ï—Å–ª–∏ –ø–æ—á–µ–º—É-—Ç–æ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª—é–±–æ–π
            usedSet.clear();
            availableSignals = [...signalArray];
        }
        
        const randomIndex = Math.floor(Math.random() * availableSignals.length);
        const signalIndex = signalArray.indexOf(availableSignals[randomIndex]);
        
        usedSet.add(signalIndex);
        return availableSignals[randomIndex];
    }

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
    async function loadSignals() {
      try {
        loadingStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤...';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ normal_signals.txt
        const normalResponse = await fetch('normal_signals.txt');
        if (!normalResponse.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å normal_signals.txt');
        const normalText = await normalResponse.text();
        NORMAL_SIGNALS = normalText.split('\n')
          .map(line => line.trim())
          .filter(line => line.length > 0);

        loadingStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–æ–º–∞–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤...';
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ creepy_signals.txt
        const creepyResponse = await fetch('creepy_signals.txt');
        if (!creepyResponse.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å creepy_signals.txt');
        const creepyText = await creepyResponse.text();
        CREEPY_SIGNALS = creepyText.split('\n')
          .map(line => line.trim())
          .filter(line => line.length > 0);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–µ –ø—É—Å—Ç—ã–µ
        if (NORMAL_SIGNALS.length === 0) throw new Error('–§–∞–π–ª normal_signals.txt –ø—É—Å—Ç');
        if (CREEPY_SIGNALS.length === 0) throw new Error('–§–∞–π–ª creepy_signals.txt –ø—É—Å—Ç');

        // –í–º–µ—Å—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏
        loadingStatus.textContent = '';
        receiveBtn.disabled = false;
        receiveBtn.textContent = '–ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª';
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å "–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ" –≤ –≤–µ—Ä—Ö–Ω–µ–π –∫–æ–Ω—Å–æ–ª–∏
        statusText.value = '–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.';
        
        console.log('–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:', NORMAL_SIGNALS);
        console.log('–ê–Ω–æ–º–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã:', CREEPY_SIGNALS);

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:', error);
        loadingStatus.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`;
        loadingStatus.style.color = 'var(--creepy-red)';
        
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ —Ñ–∞–π–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å
        NORMAL_SIGNALS = ["–†–µ–∑–µ—Ä–≤–Ω—ã–π –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª: —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ"];
        CREEPY_SIGNALS = ["–†–µ–∑–µ—Ä–≤–Ω—ã–π –∞–Ω–æ–º–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª: –û–®–ò–ë–ö–ê –°–ò–°–¢–ï–ú–´"];
        receiveBtn.disabled = false;
        receiveBtn.textContent = '–ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º)';
        statusText.value = '–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Ä–µ–∂–∏–º)';
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
    filterToggle.addEventListener('change', function() {
        if (this.checked) {
            filterStatus.textContent = '–í–ö–õ';
            filterStatus.classList.add('active');
            statusText.value = '–§–∏–ª—å—Ç—Ä –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á–∞—Å—Ç–æ—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.';
        } else {
            filterStatus.textContent = '–í–´–ö–õ';
            filterStatus.classList.remove('active');
            statusText.value = '–§–∏–ª—å—Ç—Ä –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –í—Å–µ —á–∞—Å—Ç–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã.';
        }
    });

    // –≠—Ñ—Ñ–µ–∫—Ç –ó–∞–ª–≥–æ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π)
    function zalgo(text, intensity=5) {
      const zalgoChars = [
        '\u030d','\u030e','\u0304','\u0305','\u033f','\u0311','\u0306','\u0310',
        '\u0352','\u0357','\u0351','\u0307','\u0308','\u030a','\u0342','\u0343',
        '\u0344','\u034a','\u034b','\u034c','\u0303','\u0302','\u030c','\u0350',
        '\u0300','\u0301','\u030b','\u030f','\u0312','\u0313','\u0314','\u033d',
        '\u0309','\u0363','\u0364','\u0365','\u0366','\u0367','\u0368','\u0369',
        '\u036a','\u036b','\u036c','\u036d','\u036e','\u036f','\u033e','\u035b',
        '\u0346','\u031a'
      ];
      let result = '';
      for (let c of text) {
        result += c;
        if (/[a-zA-Z0-9:. ]/.test(c)) {
          let count = Math.floor(Math.random() * intensity);
          for (let i=0; i<count; i++) {
            result += zalgoChars[Math.floor(Math.random() * zalgoChars.length)];
          }
        }
      }
      return result;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const target = tab.dataset.tab;
        tabContents.forEach(tc => {
          tc.style.display = (tc.id === target) ? 'flex' : 'none';
        });
      });
    });

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–∫–∞ –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–†–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø—ã"
    function updateTelescopeTabBadge() {
      const tab = document.querySelector('.tab[data-tab="telescopes"]');
      const hasBroken = TELESCOPES.some(t => t.status === 'offline');
      if (hasBroken) {
        if (!tab.querySelector('.badge')) {
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = '‚óè';
          tab.appendChild(badge);
        }
      } else {
        const badge = tab.querySelector('.badge');
        if (badge) badge.remove();
      }
    }

    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–¥–∏–æ—Ç–µ–ª–µ—Å–∫–æ–ø–æ–≤
    function renderTelescopes() {
      telescopesBody.innerHTML = '';
      TELESCOPES.forEach((t, i) => {
        const tr = document.createElement('tr');

        const tdName = document.createElement('td');
        tdName.textContent = t.name;
        tr.appendChild(tdName);

        const tdStatus = document.createElement('td');
        tdStatus.textContent = t.status === 'online' ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ—Ñ–ª–∞–π–Ω';
        tdStatus.className = t.status === 'online' ? 'status-online' : 'status-offline';
        tr.appendChild(tdStatus);

        const tdConn = document.createElement('td');
        tdConn.textContent = t.connection;
        tdConn.className = t.connection === '–•–æ—Ä–æ—à–µ–µ' ? 'connection-good' : 'connection-bad';
        tr.appendChild(tdConn);

        const tdAction = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = '–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å';
        btn.className = 'reconnect-btn';
        btn.disabled = t.status === 'online' || reconnectInProgress.has(i);
        btn.addEventListener('click', () => reconnectTelescope(i));
        tdAction.appendChild(btn);
        tr.appendChild(tdAction);

        telescopesBody.appendChild(tr);
      });
      updateTelescopeTabBadge();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å —Å–∏–≥–Ω–∞–ª"
    function updateReceiveButton() {
      const allOnline = TELESCOPES.every(t => t.status === 'online');
      const signalsLoaded = NORMAL_SIGNALS.length > 0 && CREEPY_SIGNALS.length > 0;
      receiveBtn.disabled = !allOnline || !signalsLoaded || isDecrypting;
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è "–∑–∞–≥—Ä—É–∑–∫–∞" —Å —Ç–æ—á–∫–∞–º–∏
    function animateStatusLoading(baseMessage, duration = 3000) {
      let dots = 0;
      statusText.value = baseMessage;
      return new Promise(resolve => {
        const interval = setInterval(() => {
          dots = (dots + 1) % 6;
          statusText.value = baseMessage + '.'.repeat(dots);
        }, 400);
        setTimeout(() => {
          clearInterval(interval);
          resolve();
        }, duration);
      });
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—ç—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏)
    function animateText(element, text, creepy = false) {
  return new Promise(resolve => {
    element.value = '';
    const lines = text.split('\\n');
    let currentLine = 0;
    let currentChar = 0;
    let soundCounter = 0;
    
    function step() {
      if (currentLine >= lines.length) {
        resolve();
        return;
      }
      
      if (currentChar < lines[currentLine].length) {
        element.value += lines[currentLine][currentChar];
        currentChar++;
        
        // –ó–í–£–ö –¢–û–õ–¨–ö–û –ö–ê–ñ–î–´–ô 3-–ô –°–ò–ú–í–û–õ
        soundCounter++;
        if (soundCounter % 3 === 0) {
          setTimeout(() => {
            try {
              comSound.currentTime = 0;
              comSound.play().catch(e => {});
            } catch (e) {}
          }, 10);
        }
        
      } else {
        element.value += '\n';
        currentLine++;
        currentChar = 0;
      }
      
      if (creepy) {
        // üî• –ö–†–ê–°–ù–´–ô –¶–í–ï–¢ –° –ö–†–ê–°–ù–û–ô –ü–û–î–°–í–ï–¢–ö–û–ô
        element.style.color = 'var(--creepy-red)';
        element.style.textShadow = '0 0 10px var(--creepy-red-glow), 0 0 20px var(--creepy-red-glow)';
      } else {
        // –ñ—ë–ª—Ç—ã–π —Ü–≤–µ—Ç —Å –∂—ë–ª—Ç–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
        element.style.color = 'var(--soft-yellow)';
        element.style.textShadow = '0 0 5px var(--soft-yellow-glow), 0 0 15px var(--soft-yellow-glow)';
      }
      element.scrollTop = element.scrollHeight;
      
      setTimeout(step, 50);
    }
    
    step();
  });
}
    // –ê–Ω–∏–º–∞—Ü–∏—è –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ —Å —à—É–º–æ–º (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ—Å–ª–µ –±–∏—Ç–æ–≤)
    function animateBinaryWithNoise(element, binaryStr) {
      return new Promise(resolve => {
        element.value = '';
        let i = 0;
        const noiseChars = ['|', '-', '~', '*'];
        function step() {
          if (i >= binaryStr.length) {
            resolve();
            return;
          }
          element.value += binaryStr[i];
          // –° –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 50% –¥–æ–±–∞–≤–ª—è–µ–º —à—É–º
          if (Math.random() < 0.5) {
            element.value += noiseChars[Math.floor(Math.random() * noiseChars.length)];
          }
          element.scrollTop = element.scrollHeight;
          i++;
          setTimeout(step, 30);
        }
        step();
      });
    }

    // –û—á–∏—Å—Ç–∫–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ –∫–æ–¥–∞ –æ—Ç —à—É–º–æ–≤
    function cleanBinaryFromNoise(element, binaryStr) {
      return new Promise(resolve => {
        let i = 0;
        const cleanBinary = binaryStr.replace(/[^01]/g, '');
        
        function step() {
          if (i >= cleanBinary.length) {
            resolve();
            return;
          }
          // –ó–∞–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Å–∏–º–≤–æ–ª –Ω–∞ —á–∏—Å—Ç—ã–π
          const currentText = element.value;
          const newText = cleanBinary.substring(0, i + 1);
          element.value = newText;
          element.scrollTop = element.scrollHeight;
          i++;
          setTimeout(step, 20);
        }
        step();
      });
    }

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—á–∏–Ω–∫–∏ —Ç–µ–ª–µ—Å–∫–æ–ø–∞
    function animateConnectionLoading(telescopeIndex) {
      const frames = [
        "‚ñë ‚ñë ‚ñë ‚ñë",
        "‚ñì ‚ñë ‚ñë ‚ñë",
        "‚ñì ‚ñì ‚ñë ‚ñë",
        "‚ñì ‚ñì ‚ñì ‚ñë",
        "‚ñì ‚ñì ‚ñì ‚ñì"
      ];
      const telescope = TELESCOPES[telescopeIndex];
      let repeatCount = Math.floor(Math.random() * 3) + 1;
      let frameIndex = 0;
      let repeatsDone = 0;

      return new Promise(resolve => {
        function nextFrame() {
          telescope.connection = frames[frameIndex];
          renderTelescopes();
          frameIndex++;
          if (frameIndex >= frames.length) {
            frameIndex = 0;
            repeatsDone++;
          }
          if (repeatsDone < repeatCount) {
            setTimeout(nextFrame, 1000);
          } else {
            // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            telescope.status = "online";
            telescope.connection = "–•–æ—Ä–æ—à–µ–µ";
            renderTelescopes();
            updateReceiveButton();
            statusText.value = "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ.";
            resolve();
          }
        }
        nextFrame();
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–ª–µ—Å–∫–æ–ø–∞ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
    async function reconnectTelescope(index) {
      if (reconnectInProgress.has(index)) return;
      reconnectInProgress.add(index);

      const telescope = TELESCOPES[index];
      if (telescope.status === "online") {
        reconnectInProgress.delete(index);
        return;
      }
      telescope.connection = "–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...";
      renderTelescopes();
      updateReceiveButton();

      await animateConnectionLoading(index);

      reconnectInProgress.delete(index);
    }

    // –ó–∞–ø—É—Å–∫ ambient.mp3 –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ
    let ambientStarted = false;
    function startAmbient() {
      if (!ambientStarted) {
        ambientAudio.play().then(() => {
          ambientStarted = true;
        }).catch((e) => {
          console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è ambient.mp3:', e);
        });
      }
    }

    // –ü–æ–ª–æ–º–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç–µ–ª–µ—Å–∫–æ–ø–∞
    function breakRandomTelescope() {
      const onlineTelescopes = TELESCOPES.filter(t => t.status === 'online');
      if (onlineTelescopes.length === 0) return;
      const broken = onlineTelescopes[Math.floor(Math.random() * onlineTelescopes.length)];
      broken.status = 'offline';
      broken.connection = '–ù–µ—Ç —Å–≤—è–∑–∏';
      renderTelescopes();
      updateReceiveButton();
      radiooffAudio.currentTime = 0;
      radiooffAudio.play();
    }

    // –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —Å–∏–≥–Ω–∞–ª–∞
    async function decryptSignal() {
      isDecrypting = true;
      updateReceiveButton();
      decryptBtn.disabled = true;
      
      // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∑–≤—É–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
      currentDecryptAudio = Math.random() < 0.5 ? decryptAudio1 : decryptAudio2;
      currentDecryptAudio.currentTime = 0;
      currentDecryptAudio.play();
      
      // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–µ–∫ –≤–æ –≤—Ä–µ–º—è –æ—á–∏—Å—Ç–∫–∏ –æ—Ç —à—É–º–æ–≤
      statusText.value = '–û—á–∏—Å—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç —à—É–º–æ–≤';
      await animateStatusLoading('–û—á–∏—Å—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç —à—É–º–æ–≤', 2000);

      // –û—á–∏—â–∞–µ–º –±–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–¥ –æ—Ç —à—É–º–æ–≤
      await cleanBinaryFromNoise(binaryText, binaryText.value);

      // –ê–Ω–∏–º–∞—Ü–∏—è —Ç–æ—á–µ–∫ –≤–æ –≤—Ä–µ–º—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
      statusText.value = '–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞';
      await animateStatusLoading('–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞', 2000);
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
      currentDecryptAudio.pause();
      currentDecryptAudio.currentTime = 0;
      
      // üî• –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ó–∞–º–µ–Ω—è–µ–º \n –Ω–∞ –Ω–∞—Å—Ç–æ—è—â–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      const displayResult = currentResultSignal.replace(/\\n/g, '\n');
      await animateText(resultText, displayResult, creepyActive);

      // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
      if (creepyActive) {
        statusText.value = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∞–Ω–æ–º–∞–ª–∏—è.';
        breakRandomTelescope();
      } else {
        statusText.value = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.';
      }

      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
      addSignalToHistory(currentBinarySignal, currentResultSignal, creepyActive);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
      isDecrypting = false;
      updateReceiveButton();
    }

    // –ü—Ä–∏—ë–º —Å–∏–≥–Ω–∞–ª–∞
    async function receiveSignal() {
      // –í –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —Ç–µ–ª–µ—Å–∫–æ–ø—ã –æ–Ω–ª–∞–π–Ω
      const allOnline = TELESCOPES.every(t => t.status === 'online');
      if (!allOnline) {
        statusText.value = '–û—à–∏–±–∫–∞: –Ω–µ –≤—Å–µ —Ç–µ–ª–µ—Å–∫–æ–ø—ã –æ–Ω–ª–∞–π–Ω';
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–∏–≥–Ω–∞–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
      if (NORMAL_SIGNALS.length === 0 || CREEPY_SIGNALS.length === 0) {
        statusText.value = '–û—à–∏–±–∫–∞: —Å–∏–≥–Ω–∞–ª—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
        return;
      }

      receiveBtn.disabled = true;
      decryptBtn.disabled = true;
      binaryText.value = '';
      resultText.value = '';
      statusText.value = '';

      priemAudio.currentTime = 0;
      priemAudio.play();

      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∏–≥–Ω–∞–ª
      currentBinarySignal = Array.from({length: 100}, () => Math.random() < 0.5 ? '0' : '1').join('');
      
      creepyActive = Math.random() < 0.3;
      
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–∏–≥–Ω–∞–ª—ã
      currentResultSignal = creepyActive
        ? getRandomSignal(CREEPY_SIGNALS, usedCreepySignals)
        : getRandomSignal(NORMAL_SIGNALS, usedNormalSignals);

      // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ —Å —à—É–º–æ–º
      await Promise.all([
        animateStatusLoading('–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞'),
        animateBinaryWithNoise(binaryText, currentBinarySignal)
      ]);

      priemAudio.pause();

      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏
      statusText.value = '–°–∏–≥–Ω–∞–ª –ø–æ–ª—É—á–µ–Ω. –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏.';
      decryptBtn.disabled = false;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏—ë–º–∞
      updateReceiveButton();
    }

    // –ò—Å—Ç–æ—Ä–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤ - –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–ø–∏—Å–æ–∫
    function addSignalToHistory(binary, result, creepy) {
      const now = new Date();
      let dtStr = now.toLocaleDateString('ru-RU') + ' ' + now.toLocaleTimeString('ru-RU');
      if (creepy) {
        dtStr = zalgo(dtStr, 7);
      }
      const id = signalHistory.length + 1;
      signalHistory.push({
        id, 
        datetime: dtStr, 
        binary, 
        result, // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å \n
        creepy
      });
      renderHistory();
    }

    function renderHistory() {
      historyList.innerHTML = '';
      signalHistory.forEach(signal => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = `${signal.id}. ${signal.datetime}`;
        div.dataset.id = signal.id;
        div.addEventListener('click', () => {
          // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö
          historyList.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
          // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
          div.classList.add('selected');
          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª–∞
          showSignal(signal.id);
        });
        historyList.appendChild(div);
      });
    }

    function showSignal(id) {
  const signal = signalHistory.find(s => s.id === id);
  if (!signal) return;
  statusText.value = '–°–∏–≥–Ω–∞–ª –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏.';
  binaryText.value = signal.binary;
  
  const displayResult = signal.result.replace(/\\n/g, '\n');
  resultText.value = displayResult;
  
  decryptBtn.disabled = true;
  if (signal.creepy) {
    // üî• –ö–†–ê–°–ù–´–ô –¶–í–ï–¢ –° –ö–†–ê–°–ù–û–ô –ü–û–î–°–í–ï–¢–ö–û–ô
    resultText.style.color = 'var(--creepy-red)';
    resultText.style.textShadow = '0 0 10px var(--creepy-red-glow), 0 0 20px var(--creepy-red-glow)';
  } else {
    resultText.style.color = 'var(--soft-yellow)';
    resultText.style.textShadow = '0 0 5px var(--soft-yellow-glow), 0 0 15px var(--soft-yellow-glow)';
  }
}

    deleteButton.addEventListener('click', () => {
      const selected = historyList.querySelector('.option.selected');
      if (!selected) return;
      const selectedId = parseInt(selected.dataset.id);
      signalHistory = signalHistory.filter(s => s.id !== selectedId);
      // –ü–µ—Ä–µ–Ω—É–º–µ—Ä—É–µ–º id
      signalHistory.forEach((s, i) => s.id = i + 1);
      renderHistory();
      statusText.value = '–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ.';
      binaryText.value = '';
      resultText.value = '';
      decryptBtn.disabled = true;
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    async function init() {
      renderTelescopes();
      updateReceiveButton();
      await loadSignals();
      updateReceiveButton();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    receiveBtn.addEventListener('click', () => {
      startAmbient();
      receiveSignal();
    });

    decryptBtn.addEventListener('click', () => {
      decryptSignal();
    });

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    init();
  </script>
</body>
</html>




